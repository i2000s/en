<!DOCTYPE html>
<html lang="en">

  <head prefix="dc: http://purl.org/dc/terms/ og: http://ogp.me/ns#"> <!-- namespaces used in metadata.html -->
    <!--<meta charset="utf-8">-->
    <title>Internal stability of Runge-Kutta methods</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <meta http-equiv = "X-UA-Compatible" content = "IE = edge"> -->
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
      <!--[if lt IE 9]>
      <script src = "https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src = "https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
    <meta name="subtitle" content="Some experiments in NodePy">
    
    <meta name="author" content="Xiaodong Qi | 戚晓东">
    

    <!-- HTML5 metadata -->

  <meta name="keywords" content="Xiaodong Qi, 戚晓东, numerical-analysis, Runge-Kutta-methods, stability, roundoff, SSP" />
  



  <meta name="description" content="Some experiments in NodePy" />
  


<meta http-equiv="Content-Language" content="en">
<!-- RDFa Metadata (in DublinCore) -->
<meta property="dc:title" content="Internal stability of Runge-Kutta methods" />
<meta property="dc:creator" content="Xiaodong Qi" />
<meta property="dc:date" content="2012-10-11 00:00:00 +0000" />
<meta property="dc:format" content="text/html" />
<meta property="dc:language" content="en" />
<meta property="dc:identifier" content="https://purl.org/qxd/en/2012/10/11/Internal_stability.html" />
<meta property="dc:rights" content="CC-BY" />
<meta property="dc:source" content="A Notebook of Xiaodong Qi's" />
<meta property="dc:subject" content="Physics" />
<meta property="dc:type" content="website" />
<meta name="dc.language" content="en">
<!-- RDFa Metadata (in OpenGraph) -->
<meta property="og:title" content="Internal stability of Runge-Kutta methods" />
<meta property="og:author" content="https://purl.org/qxd/en/index.html" />  <!-- Should be Liquid? URI? -->
<meta property="https://ogp.me/ns/profile#first_name" content="Xiaodong"/>
<meta property="https://ogp.me/ns/profile#last_name" content="Qi"/>
<meta property="https://ogp.me/ns/article#published_time" content="2012-10-11 00:00:00 +0000" />
<meta property="og:site_name" content="A Notebook of Xiaodong Qi's" /> <!-- Same as dc:source? -->
<meta property="og:url" content="https://purl.org/qxd/en/2012/10/11/Internal_stability.html" />
<meta property="og:type" content="website" />
<!-- Google Scholar Metadata -->
<meta name="citation_author" content="Xiaodong Qi"/>
<meta name="citation_date" content="2012-10-11 00:00:00 +0000"/>
<meta name="citation_title" content="Internal stability of Runge-Kutta methods"/>
<meta name="citation_journal_title" content="A Notebook of Xiaodong Qi's"/>
<!--NOTE: see also the COinS Metadata in span element in coins.html and footer. -->
<!-- Twitter card summary -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@i2000s" />
<meta name="twitter:title" content="Internal stability of Runge-Kutta methods" />
<meta name="twitter:description" content="" />
<meta name="twitter:image" content="https://purl.org/qxd/en/assets/img/qi2016.jpg" />
<!-- Baidu website verification code -->
<meta name="baidu-site-verification" content="5FQ1dXMyow" />

    <!-- Le styles -->
   <!--<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Quattrocento+Sans:bold,bolditalic,italic|Quattrocento+Sans">
   <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Rosario:bold,bolditalic,italic|Rosario"> -->
    <link rel="stylesheet" media="screen" href="https://fontlibrary.org/face/quattrocento-sans" type="text/css"/>
    <link rel="stylesheet" media="screen" href="https://fontlibrary.org/face/rosario" type="text/css"/>

    <!-- bootstrap style -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
    <link href = "/en/assets/css/bootstrap.min.css" rel = "stylesheet">
    <!-- Self-defined style -->
    <link rel="stylesheet" type="text/css" href="/en/assets/css/style.css">

    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-74657818-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?b155717a8e4421a6f085a26ba4e9f836";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


    <!-- Help the browser identify the RSS feed automatically -->
    <link rel="alternate" type="application/rss+xml" title="A Notebook of Xiaodong Qi's" href="/en/atom.xml" />

    <!-- favicon -->
    <link rel="apple-touch-icon" sizes="57x57" href="/en/assets/img/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/en/assets/img/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/en/assets/img/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/en/assets/img/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/en/assets/img/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/en/assets/img/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/en/assets/img/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/en/assets/img/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/en/assets/img/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/en/assets/img/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/en/assets/img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/en/assets/img/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/en/assets/img/favicon/favicon-16x16.png">
    <link rel="manifest" href="/en/assets/img/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/en/assets/img/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
  </head>

  <!-- Go to www.addthis.com/dashboard to customize your tools -->
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-54f225a84524edd3" async="async"></script>

  <body onload="load()"> <!-- load() is to offset the navbar for anchor links. -->

  
<!-- Navbar  ================================================== -->
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/en/README.html"><i class="glyphicon glyphicon-info-sign"></i></a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
         
            
            
            
            
              <li class=""><a href="/en/">Home</a></li>
            
         
            
            
            
            
              <li class=""><a href="/en/research/">Research</a></li>
            
         
            
            
            
            
              <li class=""><a href="/en/pubs/">Vita</a></li>
            
         
            
            
            
            
              <li class=""><a href="/en/community/">Community</a></li>
            
         
        </ul>
      <!-- Search site using DuckDuckGo's index -->
        <form class="navbar-form navbar-right" role="search" method="get" action="//duckduckgo.com/">
          <div class="form-group">
            <input type="hidden" name="sites" value="https://www.qixiaodong.tk" />
            <input type="hidden" value="1" name="kh"></input> <!-- To turn on https -->
            <input type="hidden" value="1" name="kn"></input> <!-- To open up a new window -->
            <input type="hidden" value="1" name="kac"></input> <!-- To turn on auto-suggestion -->
            <input type="hidden" value="e" name="ky"></input> <!-- Color of highlights. or write out the color code you want, e.g. %23395323 (%23 is an encoded # char). -->
            <input type="text" class="form-control search-query" type="search" name="q" placeholder="Search this site"/>
          </div>
          <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
       </form>

    </div><!--/.nav-collapse -->
  </div> <!-- /container -->
</nav>


  <div class="container"> <!-- Twitter bootstrap has all body content in a container -->

    <!-- Custom masthead (big titles) -->

<header class="jumbotron subhead">
    <h1 class="entry-title">Internal stability of Runge-Kutta methods</h1>
    
      <h3> Some experiments in NodePy </h3>
    
</header>

<!-- <style>
div #sticker {
  width:auto;
  padding:10px;
  margin-right:20px;
  float:right;
}
.stick {
    position:fixed;
    top:30px;}
</style>
<script type="text/javascript">
$(document).ready(function() {
    var s = $("#sticker");
    var pos = s.position();
    $(window).scroll(function() {
        var windowpos = $(window).scrollTop();
        if (windowpos >= pos.top) {
            s.addClass("stick");
        } else {
            s.removeClass("stick");
        }
    });
});
</script> -->

      <div class="row">
        <div class="col-md-8 col-md-offset-1 col-sm-12"> 
          <article>
          <p>Note: this post was generated from an iPython notebook. You can <a href="https://github.com/ketch/nodepy/blob/master/examples/Internal_stability.ipynb">download the notebook from github</a> and execute all the code yourself. This post was originally written by <a href="http://www.davidketcheson.info/2012/10/11/Internal_stability.html">David Ketcheson</a>.</p>
<p>Internal stability deals with the growth of errors (such as roundoff) introduced at the Runge-Kutta stages during a single Runge-Kutta step. It is usually important only for methods with a large number of stages, since that is when the internal amplification factors can be large. An excellent explanation of internal stability is given in <a href="http://oai.cwi.nl/oai/asset/1652/1652A.pdf">this paper</a>. Here we demonstrate some tools for studying internal stability in NodePy.</p>
<p>First, let’s load a couple of RK methods:</p>
<div class="highlight">
<pre><span class="kn">from</span> <span class="nn">nodepy</span> <span class="kn">import</span> <span class="n">rk</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">rk</span><span class="p">)</span>
<span class="n">rk4</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">loadRKM</span><span class="p">(</span><span class="s">&#39;RK44&#39;</span><span class="p">)</span>
<span class="n">ssprk4</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">loadRKM</span><span class="p">(</span><span class="s">&#39;SSP104&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">rk4</span>
<span class="k">print</span> <span class="n">ssprk4</span>
</pre>
</div>
<pre><code>Classical RK4
The original four-stage, fourth-order method of Kutta
 0   |
 1/2 |  1/2
 1/2 |  0    1/2
 1   |  0    0    1
_____|____________________
     |  1/6  1/3  1/3  1/6
SSPRK(10,4)
The optimal ten-stage, fourth order SSP Runge-Kutta method
 0   |
 1/6 |  1/6
 1/3 |  1/6   1/6
 1/2 |  1/6   1/6   1/6
 2/3 |  1/6   1/6   1/6   1/6
 1/3 |  1/15  1/15  1/15  1/15  1/15
 1/2 |  1/15  1/15  1/15  1/15  1/15  1/6
 2/3 |  1/15  1/15  1/15  1/15  1/15  1/6   1/6
 5/6 |  1/15  1/15  1/15  1/15  1/15  1/6   1/6   1/6
 1   |  1/15  1/15  1/15  1/15  1/15  1/6   1/6   1/6   1/6
_____|____________________________________________________________
     |  1/10  1/10  1/10  1/10  1/10  1/10  1/10  1/10  1/10  1/10</code></pre>
<h2 id="absolute-stability-regions">Absolute stability regions</h2>
<p>First we can use NodePy to plot the region of absolute stability for each method. The absolute stability region is the set</p>
<center>
<span class="math">\(\\{ z \in C : |\phi (z)|\le 1 \\}\)</span>
</center>

<p>where <span class="math">\(\phi(z)\)</span> is the <em>stability function</em> of the method:</p>
<center>
<span class="math">\(1 + z b^T (I-zA)^{-1}\)</span>
</center>

<p>If we solve <span class="math">\(u&#39;(t) = \lambda u\)</span> with a given method, then <span class="math">\(z=\lambda \Delta t\)</span> must lie inside this region or the computation will be unstable.</p>
<div class="highlight">
<pre><span class="n">p</span><span class="p">,</span><span class="n">q</span> <span class="o">=</span> <span class="n">rk4</span><span class="o">.</span><span class="n">stability_function</span><span class="p">()</span>
<span class="k">print</span> <span class="n">p</span>
<span class="n">h1</span><span class="o">=</span><span class="n">rk4</span><span class="o">.</span><span class="n">plot_stability_region</span><span class="p">()</span>
</pre>
</div>
<pre><code>         4          3       2
0.04167 x + 0.1667 x + 0.5 x + 1 x + 1</code></pre>
<figure>
<img src="https://dl.dropbox.com/u/656693/jekyll_images/Internal_stability_files/Internal_stability_fig_00.png" />
</figure>
<div class="highlight">
<pre><span class="n">p</span><span class="p">,</span><span class="n">q</span> <span class="o">=</span> <span class="n">ssprk4</span><span class="o">.</span><span class="n">stability_function</span><span class="p">()</span>
<span class="k">print</span> <span class="n">p</span>
<span class="n">h2</span><span class="o">=</span><span class="n">ssprk4</span><span class="o">.</span><span class="n">plot_stability_region</span><span class="p">()</span>
</pre>
</div>
<pre><code>           10             9            8             7           6
3.969e-09 x  + 2.381e-07 x + 6.43e-06 x + 0.0001029 x + 0.00108 x
            5           4          3       2
 + 0.00787 x + 0.04167 x + 0.1667 x + 0.5 x + 1 x + 1</code></pre>
<figure>
<img src="https://dl.dropbox.com/u/656693/jekyll_images/Internal_stability_files/Internal_stability_fig_01.png" />
</figure>
<h1 id="internal-stability">Internal stability</h1>
<p>The stability function tells us by how much errors from one step are amplified in the next one. This is important since we introduce truncation errors at every step. However, we also introduce roundoff errors at the each stage within a step. Internal stability tells us about the growth of those. Internal stability is typically less important than (step-by-step) absolute stability for two reasons:</p>
<ul>
<li>Roundoff errors are typically much smaller than truncation errors, so moderate amplification of them typically is not significant</li>
<li>Although the propagation of stage errors within a step is governed by internal stability functions, in later steps these errors are propagated according to the (principal) stability function</li>
</ul>
<p>Nevertheless, in methods with many stages, internal stability can play a key role.</p>
<p>Questions: <em>In the solution of PDEs, large spatial truncation errors enter at each stage. Does this mean internal stability becomes more significant? How does this relate to stiff accuracy analysis and order reduction?</em></p>
<h2 id="internal-stability-functions">Internal stability functions</h2>
<p>We can write the equations of a Runge-Kutta method compactly as</p>
<center>
<span class="math">\(y = u^n e + h A F(y)\)</span>
</center>

<center>
<span class="math">\(u^{n+1} = u^n + h b^T F(y),\)</span>
</center>

<p>where <span class="math">\(y\)</span> is the vector of stage values, <span class="math">\(u^n\)</span> is the previous step solution, <span class="math">\(e\)</span> is a vector with all entries equal to 1, <span class="math">\(h\)</span> is the step size, <span class="math">\(A\)</span> and <span class="math">\(b\)</span> are the coefficients in the Butcher tableau, and <span class="math">\(F(y)\)</span> is the vector of stage derivatives. In floating point arithmetic, roundoff errors will be made at each stage. Representing these errors by a vector <span class="math">\(r\)</span>, we have</p>
<center>
<span class="math">\(y = u^n e + h A F(y) + r.\)</span>
</center>

<p>Considering the test problem <span class="math">\(F(y)=\lambda y\)</span> and solving for <span class="math">\(y\)</span> gives</p>
<center>
<span class="math">\(y = u^n (I-zA)^{-1}e + (I-zA)^{-1}r,\)</span>
</center>

<p>where <span class="math">\(z=h\lambda\)</span>. Substituting this result in the equation for <span class="math">\(u^{n+1}\)</span> gives</p>
<center>
<span class="math">\(u^{n+1} = u^n (1 + zb^T(I-zA)^{-1}e) + zb^T(I-zA)^{-1}r = \psi(z) u^n + \theta(z)^T r.\)</span>
</center>

<p>Here <span class="math">\(\psi(z)\)</span> is the <em>stability function</em> of the method, that we already encountered above. Meanwhile, the vector <span class="math">\(\theta(z)\)</span> contains the <em>internal stability functions</em> that govern the amplification of roundoff errors <span class="math">\(r\)</span> within a step:</p>
<center>
<span class="math">\(\theta(z) = z b^T (I-zA)^{-1}.\)</span>
</center>

<p>Let’s compute <span class="math">\(\theta\)</span> for the classical RK4 method:</p>
<div class="highlight">
<pre><span class="n">theta</span><span class="o">=</span><span class="n">rk4</span><span class="o">.</span><span class="n">internal_stability_polynomials</span><span class="p">()</span>
<span class="n">theta</span>
</pre>
</div>
<pre>
    [poly1d([1/24, 1/12, 1/6, 1/6, 0], dtype=object),
     poly1d([1/12, 1/6, 1/3, 0], dtype=object),
     poly1d([1/6, 1/3, 0], dtype=object),
     poly1d([1/6, 0], dtype=object)]
</pre>


<div class="highlight">
<pre><span class="k">for</span> <span class="n">theta_j</span> <span class="ow">in</span> <span class="n">theta</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">theta_j</span>
</pre>
</div>
<pre><code>         4           3          2
0.04167 x + 0.08333 x + 0.1667 x + 0.1667 x
         3          2
0.08333 x + 0.1667 x + 0.3333 x
        2
0.1667 x + 0.3333 x

0.1667 x</code></pre>
<p>Thus the roundoff errors in the first stage are amplified by a factor <span class="math">\(z^4/24 + z^3/12 + z^2/6 + z/6\)</span>, while the errors in the last stage are amplified by a factor <span class="math">\(z/6\)</span>.</p>
<h2 id="internal-instability">Internal instability</h2>
<p>Usually internal stability is unimportant since it relates to amplification of roundoff errors, which are very small. Let’s think about when things can go wrong in terms of internal instability. If <span class="math">\(|\theta(z)|\)</span> is of the order <span class="math">\(1/\epsilon_{machine}\)</span>, then roundoff errors could be amplified so much that they destroy the accuracy of the computation. More specifically, we should be concerned if <span class="math">\(|\theta(z)|\)</span> is of the order <span class="math">\(tol/\epsilon_{machine}\)</span> where <span class="math">\(tol\)</span> is our desired error tolerance. Of course, we only care about values of <span class="math">\(z\)</span> that lie inside the absolute stability region <span class="math">\(S\)</span>, since internal stability won’t matter if the computation is not absolutely stable.</p>
<p>We can get some idea about the amplification of stage errors by plotting the curves <span class="math">\(|\theta(z)|=1\)</span> along with the stability region. Ideally these curves will all lie outside the stability region, so that all stage errors are damped.</p>
<div class="highlight">
<pre><span class="n">rk4</span><span class="o">.</span><span class="n">internal_stability_plot</span><span class="p">()</span>
</pre>
</div>
<figure>
<img src="https://dl.dropbox.com/u/656693/jekyll_images/Internal_stability_files/Internal_stability_fig_02.png" />
</figure>
<div class="highlight">
<pre><span class="n">ssprk4</span><span class="o">.</span><span class="n">internal_stability_plot</span><span class="p">()</span>
</pre>
</div>
<figure>
<img src="https://dl.dropbox.com/u/656693/jekyll_images/Internal_stability_files/Internal_stability_fig_03.png" />
</figure>
<p>For both methods, we see that some of the curves intersect the absolute stability region, so some stage errors are amplified. But by how much? We’d really like to know the maximum amplification of the stage errors under the condition of absolute stability. We therefore define the <em>maximum internal amplification factor</em> <span class="math">\(M\)</span>:</p>
<center>
<span class="math">\(M = \max_j \max_{z \in S} |\theta_j(z)|\)</span>
</center>

<div class="highlight">
<pre><span class="k">print</span> <span class="n">rk4</span><span class="o">.</span><span class="n">maximum_internal_amplification</span><span class="p">()</span>
<span class="k">print</span> <span class="n">ssprk4</span><span class="o">.</span><span class="n">maximum_internal_amplification</span><span class="p">()</span>
</pre>
</div>
<pre><code>2.15239281554
4.04399941143</code></pre>
<p>We see that both methods have small internal amplification factors, so internal stability is not a concern in either case. This is not surprising for the method with only four stages; it is a surprisingly good property of the method with ten stages.</p>
<p>Questions: <em>Do SSP RK methods always (necessarily) have small amplification factors? Can we prove it?</em></p>
<p>Now let’s look at some methods with many stages.</p>
<h2 id="runge-kutta-chebyshev-methods">Runge-Kutta Chebyshev methods</h2>
<p>The paper of Verwer, Hundsdorfer, and Sommeijer deals with RKC methods, which can have very many stages. The construction of these methods is implemented in NodePy, so let’s take a look at them. The functions <code>RKC1(s)</code> and <code>RKC2(s)</code> construct RKC methods of order 1 and 2, respectively, with <span class="math">\(s\)</span> stages.</p>
<div class="highlight">
<pre><span class="n">s</span><span class="o">=</span><span class="mi">4</span>
<span class="n">rkc</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">RKC1</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">print</span> <span class="n">rkc</span>
</pre>
</div>
<pre><code>RKC41

 0    |
 1/16 |  1/16
 1/4  |  1/8   1/8
 9/16 |  3/16  1/4   1/8
______|________________________
      |   1/4   3/8   1/4   1/8</code></pre>
<div class="highlight">
<pre><span class="n">rkc</span><span class="o">.</span><span class="n">internal_stability_plot</span><span class="p">()</span>
</pre>
</div>
<figure>
<img src="https://dl.dropbox.com/u/656693/jekyll_images/Internal_stability_files/Internal_stability_fig_04.png" />
</figure>
<p>It looks like there could be some significant internal amplification here. Let’s see:</p>
<div class="highlight">
<pre><span class="n">rkc</span><span class="o">.</span><span class="n">maximum_internal_amplification</span><span class="p">()</span>
</pre>
</div>
<pre>
    11.760869405962685
</pre>


<p>Nothing catastrophic. Let’s try a larger value of <span class="math">\(s\)</span>:</p>
<div class="highlight">
<pre><span class="n">s</span><span class="o">=</span><span class="mi">20</span>
<span class="n">rkc</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">RKC1</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rkc</span><span class="o">.</span><span class="n">maximum_internal_amplification</span><span class="p">()</span>
</pre>
</div>
<pre>
    42.665327220219126
</pre>


<p>As promised, these methods seem to have good internal stability properties. What about the second-order methods?</p>
<div class="highlight">
<pre><span class="n">s</span><span class="o">=</span><span class="mi">20</span>
<span class="n">rkc</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">RKC2</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">rkc</span><span class="o">.</span><span class="n">maximum_internal_amplification</span><span class="p">()</span>
</pre>
</div>
<pre>
    106.69110992619214
</pre>


<p>Again, nothing catastrophic. We could take <span class="math">\(s\)</span> much larger than 20, but the calculations get to be rather slow (in Python) and since we’re using floating point arithmetic, the accuracy deteriorates.</p>
<p>Remark: <em>we could do the calculations in exact arithmetic using Sympy, but things would get even slower. Perhaps there are some optimizations that could be done to speed this up. Or perhaps we should use Mathematica if we need to do this kind of thing.</em></p>
<p>Remark 2: <em>of course, for the RKC methods the internal stability polynomials are shifted Chebyshev polynomials. So we could evaluate them directly in a stable manner using the three-term recurrence (or perhaps scipy’s special functions library). This would also be a nice check on the calculations above.</em></p>
<h2 id="other-methods-with-many-stages">Other methods with many stages</h2>
<p>Three other classes of methods with many stages have been implemented in NodePy:</p>
<ul>
<li>SSP families</li>
<li>Integral deferred correction (IDC) methods</li>
<li>Extrapolation methods</li>
</ul>
<h3 id="ssp-families">SSP Families</h3>
<div class="highlight">
<pre><span class="n">s</span><span class="o">=</span><span class="mi">20</span>
<span class="n">ssprk</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">SSPRK2</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">ssprk</span><span class="o">.</span><span class="n">internal_stability_plot</span><span class="p">()</span>
<span class="n">ssprk</span><span class="o">.</span><span class="n">maximum_internal_amplification</span><span class="p">()</span>
</pre>
</div>
<pre>
    2.0212921484995547
</pre>


<figure>
<img src="https://dl.dropbox.com/u/656693/jekyll_images/Internal_stability_files/Internal_stability_fig_05.png" />
</figure>
<div class="highlight">
<pre><span class="n">s</span><span class="o">=</span><span class="mi">25</span> <span class="c"># # of stages</span>
<span class="n">ssprk</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">SSPRK3</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">ssprk</span><span class="o">.</span><span class="n">internal_stability_plot</span><span class="p">()</span>
<span class="n">ssprk</span><span class="o">.</span><span class="n">maximum_internal_amplification</span><span class="p">()</span>
</pre>
</div>
<pre>
    3.8049237837215397
</pre>


<figure>
<img src="https://dl.dropbox.com/u/656693/jekyll_images/Internal_stability_files/Internal_stability_fig_06.png" />
</figure>
<p>The SSP methods seem to have excellent internal stability properties.</p>
<h3 id="idc-methods">IDC methods</h3>
<div class="highlight">
<pre><span class="n">p</span><span class="o">=</span><span class="mi">6</span> <span class="c">#order</span>
<span class="n">idc</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">DC</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">idc</span><span class="p">)</span>
<span class="n">idc</span><span class="o">.</span><span class="n">internal_stability_plot</span><span class="p">()</span>
<span class="n">idc</span><span class="o">.</span><span class="n">maximum_internal_amplification</span><span class="p">()</span>
</pre>
</div>
<pre><code>26</code></pre>
<pre>
    6.4140166271998815
</pre>


<figure>
<img src="https://dl.dropbox.com/u/656693/jekyll_images/Internal_stability_files/Internal_stability_fig_07.png" />
</figure>
<p>IDC methods also seem to have excellent internal stability.</p>
<h3 id="extrapolation-methods">Extrapolation methods</h3>
<div class="highlight">
<pre><span class="n">p</span><span class="o">=</span><span class="mi">6</span> <span class="c">#order</span>
<span class="n">ex</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">extrap</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
<span class="n">ex</span><span class="o">.</span><span class="n">internal_stability_plot</span><span class="p">()</span>
<span class="n">ex</span><span class="o">.</span><span class="n">maximum_internal_amplification</span><span class="p">()</span>
</pre>
</div>
<pre><code>16
6</code></pre>
<figure>
<img src="https://dl.dropbox.com/u/656693/jekyll_images/Internal_stability_files/Internal_stability_fig_08.png" />
</figure>
<p>Not so good. Let’s try a method with even more stages (this next computation will take a while; go stretch your legs).</p>
<div class="highlight">
<pre><span class="n">p</span><span class="o">=</span><span class="mi">10</span> <span class="c">#order</span>
<span class="n">ex</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">extrap</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
<span class="n">ex</span><span class="o">.</span><span class="n">maximum_internal_amplification</span><span class="p">()</span>
</pre>
</div>
<pre><code>46</code></pre>
<pre>
    28073.244376758907
</pre>


<p>Now we’re starting to see something that might cause trouble, especially since such high order extrapolation methods are usually used when extremely tight error tolerances are required. Internal amplification will cause a loss of about 5 digits of accuracy here, so the best we can hope for is about 10 digits of accuracy in double precision. Higher order extrapolation methods will make things even worse. How large are their amplification factors? (Really long calculation here…)</p>
<div class="highlight">
<pre><span class="n">pmax</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">ampfac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">pmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">pmax</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">extrap</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">ampfac</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">maximum_internal_amplification</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">p</span><span class="p">,</span> <span class="n">ampfac</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
</pre>
</div>
<pre><code>1 1.99777378912
2 2.40329384375
3
 5.07204078733
4
 17.747335803
5
 69.62805786
6
 97.6097450835
7
 346.277441462
8
 1467.40356089
9
 6344.16303534
10
 28073.2443768
11
 126011.586473
12
 169897.662582</code></pre>
<pre>
    [<matplotlib.lines.Line2D at 0x2611bbe10>]
</pre>


<figure>
<img src="https://dl.dropbox.com/u/656693/jekyll_images/Internal_stability_files/Internal_stability_fig_09.png" />
</figure>
<div class="highlight">
<pre><span class="n">semilogy</span><span class="p">(</span><span class="n">ampfac</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre>
</div>
<pre>
    [<matplotlib.lines.Line2D at 0x2611a6710>]
</pre>


<figure>
<img src="https://dl.dropbox.com/u/656693/jekyll_images/Internal_stability_files/Internal_stability_fig_10.png" />
</figure>
<p>We see roughly geometric growth of the internal amplification factor as a function of the order <span class="math">\(p\)</span>. It seems clear that very high order extrapolation methods applied to problems with high accuracy requirements will fall victim to internal stability issues.</p>
<div class="references">

</div>

          </article>
          <!-- Go to www.addthis.com/dashboard to customize your tools -->
          <div class="addthis_sharing_toolbox">Share on</div>
        </div>


        <!-- Custom sidebar -->
        <div class="col-md-2 col-sm-12">
          <!-- <div id="sticker" style="width:250px"> --> <!--class="sidebar">-->
             <!-- | replace '_posts/', '' -->

<aside prefix="og:https://ogp.me/ns/article#">
  <p> <i class="glyphicon glyphicon-calendar"></i><small>
    <time datetime="2012-10-11 00:00:00 +0000"
    property="dc:created">11 Oct 2012</time></small></p>
  
  <p><small> Updated: <time
            datetime="2017-11-06 07:28:02 +0000"
            property="dc:modified">06 Nov 2017</time></small></p>
  
<!-- page.modified datetime="" -->
 <br />
          
            <p><a class="btn btn-default" href='/en/2012/10/11/A_curious_upwind_implicit_scheme_for_advection.html'><i class="glyphicon glyphicon-chevron-left"></i> prev</a>
          
          
            <a class="btn btn-default" href='/en/2012/10/11/blogging-with-notebooks-and-jekyll.html'>next <i class="glyphicon glyphicon-chevron-right"></i></a></p>
          


 <a  onclick="recordOutboundLink(this, 'Outbound Links', 'history'); return false;"  class="btn btn-default"
   href="https://github.com/i2000s/en/commits/dev/_posts/2012-10-11-Internal_stability.md"><i class="glyphicon glyphicon-time"></i> edit history</a>

  <br><br>

  <p><i class="glyphicon glyphicon-list"></i> Posted in
    
      <a rel="dc:subject" class="category"
         href="/en/categories.html#labnotebook">labnotebook</a>
    
    </p>

  <p> <i class="glyphicon glyphicon-tag"></i> tags:
    
    <!-- http://schema.org/BlogPosting/keywords -->
    <a rel="og:tag" class="tag"
       href="/en/tags.html#numerical-analysis">#numerical-analysis</a>, 
    
    <!-- http://schema.org/BlogPosting/keywords -->
    <a rel="og:tag" class="tag"
       href="/en/tags.html#Runge-Kutta-methods">#Runge-Kutta-methods</a>, 
    
    <!-- http://schema.org/BlogPosting/keywords -->
    <a rel="og:tag" class="tag"
       href="/en/tags.html#stability">#stability</a>, 
    
    <!-- http://schema.org/BlogPosting/keywords -->
    <a rel="og:tag" class="tag"
       href="/en/tags.html#roundoff">#roundoff</a>, 
    
    <!-- http://schema.org/BlogPosting/keywords -->
    <a rel="og:tag" class="tag"
       href="/en/tags.html#SSP">#SSP</a>
    </p>

   <br/>

  

   <br/>
   <p><tiny> <i class="glyphicon glyphicon-barcode"></i> SHA Hash: <a href="https://github.com/i2000s/en/commit/925cc82b26fa4cec499557dcec501bba8e641960/_posts/2012-10-11-Internal_stability.md"> 925cc82</a></tiny></p>
</aside>

<br /><br />
<div style="font-weight:bold; text-align:center;font-size:1.0em;">
 <i class="glyphicon glyphicon-chevron-left"></i> <a href="/en/archives.html">Archieves by date,</a>
 <i class="glyphicon glyphicon-list"></i> <a href="/en/categories.html">by category,</a>
 <!--<i class="glyphicon glyphicon-tag"></i>--> <a href="/en/tags.html">by tag.</a>
</div>

         <!-- </div> -->
       </div>

      </div>
<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>23 Jul 2016</span> &raquo; <a href="/en/2016/07/23/put-everything-on-a-quantum-circuit-part-i.html">Put everything on a quantum circuit--part I</a></li>
    
      <li><span>14 Oct 2013</span> &raquo; <a href="/en/2013/10/14/CFL-disk.html">A Tale of Two Theorems</a></li>
    
      <li><span>23 May 2017</span> &raquo; <a href="/en/2017/05/23/git-conflict-resolving.html">Git conflict resolving</a></li>
    
  </ul>
</div>

      <!-- Disqus Comments -->
      <div class="row">
        <div class="span12">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'qxd'; // required: replace example with your forum shortname
                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
      </div>

       <footer class="footer" style="clear:both;">
         <div class="row">
            <div class="col-md-7 col-xs-9">
              <div class="row">
               <a href="mailto:i2000s@hotmail.com" onClick="recordOutboundLink(this, 'Outbound Links', 'email'); return false;"><img src="/en/assets/img/icon-email.png" height="48px" alt="email"> </a>
<a href="https://github.com/i2000s" onClick="recordOutboundLink(this, 'Outbound Links', 'Github'); return false;"><img src="/en/assets/img/icon-github.png" height="40px" alt="github"> </a>
<a href="https://plus.google.com/+XiaodongQi"><img src="/en/assets/img/icon-gplus.png" height="40px" alt="G+"></a>
<a href="https://www.facebook.com/i2000s"><img src="/en/assets/img/icon-facebook.png" height="42px" alt="facebook"></a>
<a href="https://scholar.google.com/citations?user=6FdqHlIAAAAJ&hl=en"><img src="/en/assets/img/icon-scholar.png" height="40px" alt="GoogleScholar"></a>
<a href="https://twitter.com/i2000s"><img src="/en/assets/img/icon-twitter.png" height="45px" alt="Twitter"></a>
<a href="https://www.linkedin.com/in/xiaodongqi"><img src="/en/assets/img/icon-linkedin.png" height="40px" alt="LinkedIn"></a>
<a href="https://www.reddit.com/r/quantuminformation"><img src="/en/assets/img/icon-reddit.svg" height="41px" alt="Reddit"></a>
<a href="/en/atom.xml" onClick="recordOutboundLink(this, 'Outbound Links', 'RSS'); return false;"><img src="/en/assets/img/icon-rss.png" height="40px" alt="feed"></a>

<iframe class="github-btn" src="//ghbtns.com/github-btn.html?user=i2000s&repo=en&type=star&count=true&size=large" allowtransparency="true" frameborder="0" scrolling="0" width="150px" height="40px" style="vertical-align:middle; margin-top:9px;"></iframe>

              </div>
              <div class="row">
                <span> &nbsp; </span> <span><a href="/en/CV-XiaodongQi.pdf"
                  onclick="var that=this;
                  _gaq.push(['_trackEvent','Download','PDF',this.href]);
                  setTimeout(function(){location.href=that.href;},200);
                  return false;" class = "btn btn-default"><i class="fa fa-file-text-o fa-1x"></i> CV of Xiaodong Qi</a></span>
                <br><img alt="Creative Commons License" style="border-width:0" align="right" src="https://licensebuttons.net/l/by/3.0/88x31.png" />
                <span xmlns:dct="https://purl.org/dc/terms/" property="dct:title">Content</span> is licensed under the
                <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</a> or otherwise specified.
                <br>
              </div>
           </div>

           <div class="col-md-4 col-xs-3">
              <div class="row team-member" style="margin-top:-35px">
              <img class="img-responsive img-thumbnail img-circle" width="200px" alt="" src="/en/assets/img/qi2016.jpg" align="middle">
              </div>
           </div>
         </div>
      <div class="row" align="center" clear="both">
            <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
              <span align="center" margin-top="-10px">Copyright &copy; 2018 Xiaodong Qi. </span></a>
            <br>
      </div>
      
<!-- COinS metadata (for citation managers like Zotero etc), goes in body text -->
  <span
      class="Z3988"
      title="ctx_ver=Z39.88-2004
      &amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc
      &amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator
      &amp;rft.title=Internal stability of Runge-Kutta methods
      &amp;rft.creator=Xiaodong Qi
      &amp;rft.date=2012-10-11
      &amp;rft.language='en-US'
      &amp;rft.rights='CC-BY'
      &amp;rft_id=https://purl.org/qxd/en/2012/10/11/Internal_stability.html">
  </span>

    </footer>
   </div><!-- /container -->

        <!-- Le javascript
    ================================================== -->

    <!-- Placed at the end of the document so the pages load faster -->
    <!-- JQuery, used on a few pages as well as Bootstrap's Javascript plugins -->
    <!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js" ></script>-->
    <script src="//ajax.aspnetcdn.com/ajax/jQuery/jquery-2.2.4.min.js"></script>
    <script src="//cdn.jsdelivr.net/jquery.mixitup/latest/jquery.mixitup.min.js"></script>
    <script src="/en/assets/js/mixitup-mine.js"></script>
    <!-- Equations using MathJax -->
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "all"}, unicode: { fonts: "STIXGeneral,'Arial Unicode MS'" },
                extensions: ["AMSmath.js", "AMSsymbols.js", "MathMenu.js", "MathZoom.js"] } });       </script>
    <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'],['\\(','\\)'] ], processEscapes: true } }); </script>
    <!-- Self-defined extensions and macros. -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
      MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
        cancel: ["Extension","cancel"],
        bcancel: ["Extension","cancel"],
        xcancel: ["Extension","cancel"],
        cancelto: ["Extension","cancel"]
      });
    });
    </script>
    <!-- Customize this part for LaTeX macros.-->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      TeX: {
        Macros: {
          br: "{\\bf r}",
          bold: ["{\\bf #1}",1],
          abs: ["{\\left \\lvert {#1} \\right \\rvert}", 1],
          ket: ["{\\left| {#1} \\right\\rangle}",1],
          bra: ["{\\left\\langle{#1}\\right|}",1],
          ketbra: ["{\\left|{#1}\\vphantom{#2}\\right\\rangle\\!\\left\\langle{#2}\\vphantom{#1}\\right|}",2],
          tensor: ["{\\boldsymbol{#1}}",1],
          dd: ["{\\frac{\\mathrm{d} #1 }{\\mathrm{d} #2 }}",2], // normal derivetives.
          pp: ["{\\frac{\\partial #1}{\\partial #2}}",2], // partial derivetives.
          tr: ["{\\mathrm{Tr}}"], // trace.
        }
      //extensions: ["autoload-all.js"]
      }
    });
    //MathJax.Hub.Register.StartupHook("TeX autoload-all Ready", function () {
      //var MACROS = MathJax.InputJax.TeX.Definitions.macros;
      //MACROS.color = "Color";
      //delete MACROS.colorbox;
      //delete MACROS.fcolorbox;
    //});
    </script>
    <!-- Twitter Bootstrap Javascript -->
    <script src="/en/assets/js/bootstrap-collapse.js"></script> <!-- for collapsing navbar-->
    <!-- Unused Twitter Bootstrap Javascript
    <script src="https://www.qixiaodong.tk/en/assets/js/bootstrap-dropdown.js"></script>
    <script src="https://www.qixiaodong.tk/en/assets/js/google-code-prettify/prettify.js"></script>
    <script src="https://www.qixiaodong.tk/en/assets/js/bootstrap-transition.js"></script>
    <script src="https://www.qixiaodong.tk/en/assets/js/bootstrap-alert.js"></script>
    <script src="https://www.qixiaodong.tk/en/assets/js/bootstrap-modal.js"></script>
    <script src="https://www.qixiaodong.tk/en/assets/js/bootstrap-scrollspy.js"></script>
    <script src="https://www.qixiaodong.tk/en/assets/js/bootstrap-tab.js"></script>
    <script src="https://www.qixiaodong.tk/en/assets/js/bootstrap-tooltip.js"></script>
    <script src="https://www.qixiaodong.tk/en/assets/js/bootstrap-popover.js"></script>
    <script src="https://www.qixiaodong.tk/en/assets/js/bootstrap-button.js"></script>
    <script src="https://www.qixiaodong.tk/en/assets/js/bootstrap-carousel.js"></script>
    <script src="https://www.qixiaodong.tk/en/assets/js/bootstrap-typeahead.js"></script>
    <script src="https://www.qixiaodong.tk/en/assets/js/application.js"></script>
    -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <!--<script src = "https://code.jquery.com/jquery.js"></script>-->

    <!-- Offset the navbar for anchor tab links. Ref: https://github.com/twbs/bootstrap/issues/1768 -->
    <script>
      var shiftWindow = function() { scrollBy(0, -50) };
      window.addEventListener("hashchange", shiftWindow);
      function load() { if (window.location.hash) shiftWindow(); }
    </script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src = "/en/assets/js/bootstrap.min.js"></script>

  </body>
</html>

